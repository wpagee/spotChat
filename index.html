<!DOCTYPE html>
<html>
  <head>
    <title>Spot-Chat</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link href='http://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
    <link href="css/site.css" rel="stylesheet" type='text/css'>
  </head>

  <body>
    <div class="container-fluid">
      <div class="row">
          <div class="col-xs-6 col-sm-8 i-frame-section">

             <form id="iframe-form" class="form-horizontal" role="iframe-form" style="padding: 0px 15px;">
                <div class="form-group">
                  <div class="input-group">
                    <input type="text" class="form-control" autocomplete="off" placeholder="Enter of Drag and Drop a Spotify track Link or Url" id="url">
                    <span class="input-group-btn">
                      <button type="submit" class="btn btn-success">Go</button>
                    </span>
                  </div>
                </div>
              </form>


              <div class="embed-responsive embed-responsive-16by9">
                  <iframe id="app-iframe" 
                          src="https://embed.spotify.com/?uri=spotify:track:3xbVLFFcodMTNlLb8wuPsC" 
                          class="embed-responsive-item"
                          allowtransparency="true"
                          frameborder="0">
                  </iframe>
              </div>
          </div>

          <div class="col-xs-6 col-xs-offset-6 col-sm-offset-8 col-sm-4 chat-log">
            <div class="chat-log-header">
              <div class="chat-log-body">
                <div>
                  People Connected&nbsp;&nbsp;&nbsp;&nbsp;<span class="badge" id="peopleConected"></span>
                </div>
              </div>
            </div>
            <ul class="media-list"></ul>
          </div>
      </div>
    </div>

    <div class="container-fluid chat-message-form">
      <form id="chat-form" class="form-horizontal" role="message-form">
        <div class="form-group">
          <div class="input-group">
            <input type="text" class="form-control" autocomplete="off" placeholder="New Message" id="m">
            <span class="input-group-btn">
              <button type="submit" class="btn btn-primary">Submit</button>
            </span>
          </div>
        </div>
      </form>
    </div>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.3/moment.min.js"></script>
    <script>
      var socket = io();
      
      //get the msg
      $('#chat-form').submit(function() {
        socket.emit('chat message', $('#m').val());
        $('#m').val('');
        return false;
      });

      $('#iframe-form').submit(function() {
        socket.emit('iframe update', $('#url').val());
        return false;
      });

      //display new msg
      socket.on('chat message', function(chatMsg) {
        $('.media-list').prepend(createNewPost(chatMsg));
        setTimeout(function() {
          $('.media-list .newMsg').each(function() {
            $(this).removeClass('newMsg');
          });
        }, 10);
      });

      socket.on('iframe update', function(url) {
        $('#app-iframe').prop('src', url);
      });

      socket.on('person connected', function(count) {
        $('#peopleConected').text(count);      
      });

      socket.on('person disconnected', function(count) {
        $('#peopleConected').text(count);
      });

      $(document).on('ready', function() {
        var name = prompt('Welcome, please enter the user name you would like to display.');
        socket.emit('setUser', name);        
      });

      function createNewPost(chatMsg) {
        return [
                '<li class="media newMsg">',
                '<div class="media-body">',
                '<h3 class="media-heading">',
                chatMsg.name,
                '<small>Posted: ',
                chatMsg.dateTime,
                '</small>',
                '</h3>',
                '<p>',
                chatMsg.message,
                '</p>',
                '</div>',
                '</li>'
              ].join(' ');
      };
    </script>

  </body>
</html>